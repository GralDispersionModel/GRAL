Aenderungen-Code:

15.5.07
Sigma-w bei stabiler und neutraler Schichtung konstant = surface layer gesetzt.
Reflexion an Mischungsschichtoberrand bei stabiler und neutraler Schichtung ausgeschaltet.
Im File "meteo.all" wird in der 1.Zeile die Anemometerhoehe abgefragt.
Dissipation von Kaimal et al. für stabile und neutrale Schichtung etwas abgeändert.
Berechnung der maximalen effektiven Quellhoehe entsprechend Hurley, 2005. Dissipation für 
Abgasfahne um 1/3 reduziert. Einmischungskonstante a für stabile Schichtung verringert.
U* wird in Abhängigkeit von der Windgeschwindigkeit und der Rauhigkeitslänge, Obukhov-Länge räumlich
inhomogen berechnet (nur für GRAMM-Windfelder). Dazu ist das File landuse.dat notwendig.
Mittels file "meteopgt.all" koennen nun auch Pasquill-Gifford Klassen (1=A,..,7=G)
verwendet werden. Ustern wird nicht mehr nach Weber (1999) sondern nach Venkatram and Du (1997)
berechnet.
sigma-w bei labiler Schichtung wurde geändert. In bodennähe wurde eine von L abhängige Funktion auf Basis
von Literaturangaben (z.B. Panofski 1977) erfunden und über eine Transferfunktion mit der Funktion
aus Franzese et al. (1999), welche oberhalb des Surface-Layers angewandt wird verknüpft.
Bei ebenem Gelaende kann nun auch ein Gebaeudeeinfluss ohne GRAMM-Windfeld gerechnet werden, indem 
das File "Gebaeude.dat" ins Rechenverzeichnis reinkopiert wird.
Die Konzentrationsfiles werden anstatt mit Endung .dat mit .con versehen.
Im File "GRAL.geb" muessen jetzt die einzelnen Quellgruppen, getrennt durch Beistriche, eingegeben
werden, die berechnet werden sollen.
Die Bezeichnung des Files flaeche.dat wurde in portals.dat geändert. Es ist dort nur mehr die Angabe von 
zwei Eckpunkten und den beiden Höhen notwendig.
Beim Einlesen der Schadstoffe bei Punktquellen wurde PM mit HC vertauscht.

18. Juni 2008:
Reflexion der Partikel bei Gebaeudeeinfluss wurde neu implementiert, da asymetrische Konzentrationsverteilungen
auftraten.
Linien- und Katasterquellen koennen nun auf mehrere Files aufgeteilt werden (cadastre01,...,line03...).

November 2008:
Common Blöcke aufgelöst. Kommentarzeichen einheitlich auf "C" gesetzt. Fortsetzungszeichen auf"&" gesetzt.
Das kartesische Gitter wird jetzt in der Vertikalen nicht mehr konstant sondern mit einem beliebigen
Strechingfaktor nach oben vergrößert, was einiges an Arbeitsspeicher spart. Der Strechingfaktor wird im GRAL.geb
neben der Zellhöhe für die unterste Zelle eingelesen.

Mai 2009:
Einlesen des binären Windfeldes von GRAMM: Umstellen der Schleife -> Achtung: alte Windfelder können möglicherweise nicht mehr richtig eingelesen werden.
Berechnung der Boundary-Layer-Height (blh) nicht mehr in Abhängigkeit von der Topographie, da diese als Legoland abgebildet wird.

September 2009:
bei Punktquellen wird nun mit der mittleren Auftriebsgeschwindigkeit zw. zwei Zeitpunkten gerechnet.
Zusaetzlich wird der Zeitschritt bei punktquellen die ersten 20 s mit 0.2 s begrenzt. In der Gl. für G wurde ein Zusatzterm
für die TKE entsprechend Anfossi et al. (2006, Ed. Zannetti) eingeführt. Zusätzlich wurde die bent-over entrainment constante
b für convektive Bedingungen von 0.6 auf 1.0 erhöht (Anfossi et al. 2006 schlagen eine Erhöhung auf 0.7 vor).

Jänner 2010:
Horizontalen Langevin Gleichungen nach Anfossi et al. (2009) erweitert, um Well-mixed Kriterium in stark inhomogenen
Strömungen zu erfüllen. Bei Kopplung mit GRAMM wird nun die TKE und die Dissipation für die Turbulenzparametrisierung
in GRAL übernommen. Wenn die Dissipation von GRAMM kleiner als die parametrisierte in GRAL wird, dann wird auf
die bestehenden Turbulenzparametrisierungen in GRAL zurückgegriffen.

April 2010:
Beim Algorithmus für die Gebäudeberücksichtigung wurden zwei Möglichkeiten (Levels) eingeführt:
Eingabe im File ein.dat
Level 1: nur Massenkontinuität durch Ausgleich über Vertikalgeschw. erfüllt
Level 2: Erhaltungsgleichungen für Impuls und Masse werden näherungsweise gelöst

August 2010:
Bei der Ausgabe der 2D Konzentrationsfelder wurde der Glättungsalgorithmus wieder rausgenommen und auf die alte Ausgabe (Jänner 2010)
zurückgestellt, da die Glättung nicht funktioniert hat.
Bei Topographie wurde ein geänderter Algorithmus für die Windfeldinterpolation von GRAMM auf das kartesische GRAL-Gitter eingebaut.
Das Interpolationsverfahren fuer die Geländeoberfläche wurde von einer 4-Punkt auf eine 16-Punkt Matrix erweitert und der
Gewichtungsfaktor von linear auf quadratisch geändert.

//Bei Geländeinfluss und Level 2 wird immer auf
das Turbulenzschema ohne Gebaeude umgeschaltet, da bei stabiler Schichtung der Ansatz sig.w~1.5*TKE zu zu großen Werten führen dürfte.//

Juni 2011:
Interaktive Eingabe wurde gelöscht. Stattdessen wird über das Controlfile "in.dat" eingelesen.
Die Files "ggeom.dat" und "windfeld.dat" können nun auch über einen Pfad, der in diesen Files gespeichert ist, eingelesen werden. Es ist
damit nicht mehr notwendig, diese beiden Files im Rechenverzeichnis abzulegen.

Sept 2011:
Bei Topographie und Gebäuden wird bei Punktquellen, die unterhalb von Gebäuden liegen, die Höhe auf den Gebäudeoberrand gesetzt.
Achtung: Ohne Topographie wird dies noch nicht gemacht.

Nov 2011:
Bei Berechnungen ohne Gelände und bei klassifizierten Wetterlagen, wird die Windrichtung innerhalb der gewählten Sektorbreite
ausgewürfelt, um fingerartige Strukturen zu vermeiden.
Die Dateien landuse.dat und ggeom.dat wurde auf landuse.asc und ggeom.asc umgeändert.

Dez 2011:
Bei der Reflexion von Teilchen wurde generell der Faktor 0,5 eingeführt (reflexion.for). Partikel die reflektiert wurden
werden bei der Konzentrationsberechnung im nachfolgenden Zeitschritt nicht mehr berücksichtigt.
Bei Verwendung der met. Eingangsdaten inputzr.dat oder sonic.dat wird keine untere Schranke mehr für die 
Windgeschwindigkeitsfluktuation in hor. Richtung gesetzt (V0int).
Die Aenderungen betreffen die Routinen lagrange.for und insta.for.

Jän 2012:
Bug: Bei Verwendung von meteopgt.all wurden die Standardabweichungen der Windgeschwindigkeitsfluktuationen nicht entsprechend
der Mittelungszeit korrigiert.
Die Windgeschwindigkeitsfluktuation wurden in alle drei Raumrichtungen neu parametrisiert. Die bislang benutzten
Parametrisierungen ergaben in horizontaler Richtung eine zu starke Zunahme mit der Höhe bei labiler und stabiler Schichtung.
Bei Punktquellen wird nun auch bei ebenem Gelände die Quelle auf mindestens der Rauhigkeitslänge gesetzt.
Monin-Obukhov Länge neu parametrisiert entsprechend TA-Luft.
Mikroskaliges Strömungsmodell (LEVEL 2) etwas umgebaut: Dissipation wird nicht mehr prognostisch sondern diagnostisch,
entsprechend dem alten Ansatz in GRAMM über Mischungsweglänge für neutrale Schichtung berechnet. Dadurch: bessere
Konvergenz und numerische Stabilität. Die berechneten TKE und Dissipationsfelder werden aber nicht mehr für die Ausbreitung
verwendet, auch nicht wenn GRAMM vorgeschaltet wird.
Windfeldinterpolation ohne Gelände wurde für die Files inputzr.dat und sonic.dat richtig gestellt.
Mäandrieren wird nicht mehr über windge10 geschaltet sondern ueber windge.
Bei Ausbreitungszeiten <=600 Sekunden wird Mäandrieren automatisch abgeschaltet.
Die Windprofile wurden etwas abgeändert.
Reflexions der Partikel findet am Boden jetzt bei z=0 und nicht mehr bei z=z0 statt.
Tunnelmodul: Modell nach Van Dop für Auftrieb wurde ersetzt durch einfache Parametrisierung der Dissipation in Abhängigkeit
von der Temperaturdifferenz. Reflexionsbedingung wurde eingebaut, sodass bei Auftreffen der Tunnelabluft auf ein Gebäude
im Anschluss mit Standardausbreitung weiter gerechnet wird. Dadurch können nun auch Gebäude in ebenem als auch im Gelände
berücksichtigt werden. Die Parametrisierung wurde so geändert, dass nun mit einem konstanten Stiffnessparameter (jedoch unterschiedlich
für die Längs- und Querkomponente der Tunnelabluft) gerechnet wird. Es wurde die minimale horizontale Windgeschwindigkeitsfluktuation
von 0,5 m/s entfernt. GRAL liest den Parameter Stiffness nicht mehr ein.
Das Windfeld von GRAMM wird nun als Textfile getrennt für jede Wetterlage eingelesen.
Konzentrationsfiles werden als Textfiles mit fuenfstelliger Angabe der Wetterlage ausgeschrieben.
Die Aenderungen betreffen die Routinen lagrange.for, franzesesta.for, franzesekon.for, anfangko.for, pressure.for,
inputpgt.for, inputak.for und insta.for.

Mai 2012:
GRAL wurde parallelisiert mit OpenMP.
Reflexion bei Gebäuden beim Tunnelmodul wurde geändert.
tunfak ist in Originalversion nicht public!!
Die Windgeschwindigkeit wird bei Teilcheninitialisierung erst nach der Berechnung der STandardabweichungen der hor.
Windgeschwindigkeiten berechnet, diese wird aber schon vorher benötigt!!
Beim Auftrieb nach Hurly wie Windgeschwindigkeit nicht mehr als Mittel über zwei folgende Zeitschritte sondern jene
des alten Zeitschritts genommen.
Ueber die Datei Roadheight.txt kann nun flexibel die Hoehe der Mischungsschicht ueber einer Strasse eingegeben werden.
Relaxationsfaktor fuer Level2 wird bei Gitterzellen unter 3m auf 0,01 gesetzt.

August 2012:
Unplausible Ergebnisse bei den Tunnelportalen haben folgende Veränderungen bewirkt:
Bei Austrittsgeschwindigkeit = 0m/s gab es einige Divisionen durch Null, diese wurden behoben.
Bei horizontalen Windgeschwindigkeitskomponenten = 0 (z.B. UYint=0) hat der ADAPT Algorithmus nicht funktioniert,
da immer mit 0 multipliziert wurde.
Die Abfrage, ob der Tunneljet gleich dem Umgebungswind ist, war an der falschen Stelle im Code, daher gab
es sekundäre Immissionsmaxima beim Umschalten auf die Umgebungsturbulenz. Daher war in den früheren Versionen diese
Option ausgeschaltet. Jetzt ist sie drinnen.
Bei der Jetausbreitung wurde nun auch die Umgebungsturbulenz in vertikaler und horizontaler Richtung berücksichtigt.
Der Effekt ist jedoch gering. Insgesamt ergibt sich aber nun eine plausiblere Abhängigkeit der Immissionen
von der Ausbreitungsklasse.

September 2012:
Bei der Reflexion der Tunnelabluft bei einem Gebäude ergaben sich unrealistisch hohe Konzentrationen (Konzentrationsanstiege)
im Bereich der Gebäudefassaden. Abhilfe: Die Differenzgeschwindigkeit zwischen Tunnelabluftstrahl und Umgebungswind im Bereich
der Gebäudefassade (bei der Reflexion der Partikel an der Gebäudefassade) wird in turbulente kinetische Energie in isotroper
Form umgewandelt. Damit konnte das Problem behoben werden. Änderung im File Zeitschleife.for

Oktober 2012:
Bei der Reflexion von Partikelen traten noch immer erhöhte Konzentrationen an Fassaden auf (bei normaler Ausbreitung als auch bei Tunnelabluft). 
Durch Erhöhung der Standardabweichungen der Windgeschwindigkeitsfluktuationen nach einer Reflexion konnte das Problem einigermaßen in den Griff
bekommen werden.
Die Eingabe der Höhe einer Lärmschutzwand erfolgt nach wie vor über den entsprechenden Spalteneintrag im File linie.dat.
Ist dieser Wert gleich null, so wird die Mischungsschicht über der Straße auf 3m gesetzt, ist dieser Wert negativ, so wird
dieser Wert als Mischungsschicht interpretiert.

Jänner 2013:
Bei Rauigkeitslängen gleich Null ergab sich eine Division durch Null bei der Dissipation.
Minimum Rauigkeit ist nun gleich 0,00001m gesetzt.
Die Variablen tunpa und aufhurly werden initial in jedem Fall gleich Null gesetzt, 
damit keine zufälligen Werte darauf gelegt werden.

März 2013:
Bei der Reflexion an Gebäuden bei ebenem Gelände war ein Fehler in der Indizierung von AHK.
Bei negativen Monin-Obukhov Längen wird die  Mischungsschichthöhe in Abhängigkeit von der MO-Länge berechnet, um unplausible 
Konzentrationen in diesen Fällen zu vermeiden (bei der Bestimmung von AKLA nach Öttl, 2012 tritt dieses Problem
aber auch bisher nicht auf, da hier die minimale Mischungsschichthöhe ohnehin schon ca. 500 m betrug).
Der Algorithmus für die vertikalen Windgeschwindigkeitsflukutationen ist unter bestimmten Umständen (niedrige MS-Höhe, Labil) numerisch
instabil gewesen. Durch Eingrenzung des Parameters "alpha" auf +-0,1 konnte das Problem behoben werden.
Es werden bei labiler Schichtung nun keine Teilichen mehr entfernt, wenn diese über der Mischungsschicht sind.
Der Stabilitätsparameter "s" bei der Berechnung der Fahnenüberhöhung nach Hurley, 2005 wird nun bei positiven MO-Längen in Abhängigkeit
von derselben berechnet. Dadurch werden gewisse extreme Unstetigkeiten bei der Berechnung von bodennahen Konzentrationen für hohe Kamine
bei stabilen, windschwachen Wetterlagen etwas mehr geglättet.
Da beim Datensatz Kaisermühlentunnel nur die beiden höchst belasteten Punkte gemäß RVS simuliert werden konnten, wurde die Trägheit des
Tunneljets (Parameter tunjettraeg) in Abhängigkeit vom Austrittsimpuls (Fläche x Geschwindigkeit) parametrisiert. Dadurch wird eine stärkere
Trägheit beim Kaisermühlentunnel und bessere Ergebnisse erreicht.

Mai 2013:
Das interne mikroskalige Strömungsmodell in GRAL (LEVEL 2) zeigte in Ausnahmefällen doch noch Instabilitäten. Dies 
wurde durch die Abfrage des Trends der Massendivergenz verbessert (in pressure.for)

November 2013:
Bei der Ausgabe der Konzentrationsfelder kann ein Flag gesetzt werden (letzte Zeile in in.dat), damit das Format entweder ASCII (Flag=0)
oder STREAM (Flag >0) ist. Dieses Flag steuert auch den Input von GRAMM Windfeldern als Stream.

August 2014:
Geändert wurde der Bereich, um den bei Level 2 die Umströmung um Gebäude berechnet wird von der 10- auf die 15-fache Gebäudehöhe.
Außerdem wurde die Numerik des progn. mikroskaligen Strömungsmodells verbessert. Genaueres siehe GRAL Dokumentation.
Im File zeitschleife.for war ein Abfragefehler bei Level=2 (ohne Topographie) bei den Variablen DUDX usw. Diese Schleife wurde nie 
durchlaufen. Die Werte werden aber trotzdem nicht berechnet, da die Ergebnisse deutlich schlechter werden.
In anfangkor.for wird nun bei ebenem Gelände und Gebäude abgefragt, ob Quellen innerhalb von Gebäuden sind. Wenn ja, dann werden die Quellen
automatisch auf das Dach gesetzt.
windgebdia.for: Wenn mehr als eine Messhöhe für Winddaten verwendet wurde (inputzr.dat), dann wurden die Windgeschwindigkeiten
unterhalb der untersten Messhöhe falsch interpoliert.
zeitschleife.for: Wenn mehr als eine Messhöhe für Wind- und Turbulenzdaten verwendet wurde (inputzr.dat), wurden U0 und V0 unterhalb der untersten
Messhöhe falsch interpoliert.
zeitschleife.for: differenz ist über gebäuden falsch berechnet (wird als Abstand über dem Gebäude berechnet und nicht über Grund). Daher wurde z.Bsp.
die Dissipation über Gebäude falsch berechnet. Es wurde eine zweite relative Höhe "diff_building" eingeführt. Nach einigen Tests wurde aber diff_building
=differenz gesetzt.
lagrange.for: Wenn der Absolutwert des Flags IOUTPUT größer als 1 ist, werden die Gebäudehöhen im Modell im File "building_heights.txt" ausgeschrieben.
zeitschleife.for: Bei der Berechnung der Dissipation wird bei der Division durch den z-Abstand vom Erdboden der Maximalwert des Abstandes bzw. der 
Rauigkeitslänge verwendet, da ansonsten unrealistisch hohe eps-Werte berechnet werden und die Standardabweichungen der Windgeschwindigkeitsfluktuationen
manchmal unrealistisch anwachsen.
Im File zeitreihe.dat erfolgt die Ausgabe mit drei Dezimalstellen genau anstelle mit einer Stelle, da in einem Anwendungsfall Rundungsfehler auftraten.
Im File windgebdia.for wird das logarithmische Windprofil nun gleich wie im File intwind.for berechnet.

Oktober 2014:
Für die Berechnung des Zeitschritts beim mikroskaligen prognostischen Strömungsmodell wird nun auch die vertikale Zellhöhe verwendet.
Falls die Divergenz ansteigt bzw. zu hohe Geschwindigkeiten berechnet werden, wird ein Textfile Problemreport_GRAL.txt ausgeschrieben.
Wenn im Berechnungsordner von GRAL der File GRAL_topofile.txt vorhanden ist, dann wird dieser File verwendet,
um die Topographie in GRAL festzulegen, anstelle eines Interpolationsverfahrens für die GRAMM Topographie.
Das File GRAL_topofile.txt muss in der gleichen horizontalen Auflösung vorliegen wie die GRAL Berechnung und
auch die gleichen räumlichen Ausdehnungen haben.
Wenn im Berechnungsordner von GRAL der File GRAL_Topography.txt vorhanden ist, dann wird die GRAL Topographie
im gleichnamigen File ausgeschrieben.
Wenn im Berechnungsordner von GRAL der File GRAL_topofile.txt vorhanden ist, dann wird dieser File als Topograhpie verwendet und nicht
die interpolierte GRAMM Topographie. Damit kann das Gelände auch bei grober GRAMM Auflösung hoch aufgelöst werden.

November 2014:
An den vom Benutzer definierten Aufpunkten wird bei Berücksichtigung von Gebäuden das mikroskalige Strömungsfeld im File GRAL_Meteozeitreihe.dat ausgeschrieben.
Die Routine anfangkor.for wurde parallelisiert.

Dezember 2014:
Wenn Tunneljet auf Gegenfahrbahn kommt, wird dieser zerstört. Definition derartiger Gegenfahrbahnen ist ueber das File
"opposite_lane.txt" möglich. Gleiche Filestruktur wie buildings.dat.
Das Absaugen von Emissionen in die Gegenröhre erfolgt durch Definition einer Zone im File "tunnel_entrance.txt".

Februar 2015:
Die Ausgabe für den Test-Datensatz Michelstadt wurde geändert.

Juni 2015:
Ausgabe der *con Files auf stream umgestellt.
GRAL-Strömungsfelder können nun optional ausgeschrieben (und eingelesen) werden.
windneu.for: Schleife zum Eliminieren der Divergenz am Ende führt zu unrealistisch hohen w-Werten am Oberrand. Diese wird
nun übersprungen, wenn Strömungsfelder prognostisch berechnet werden. Bei diagnostischer Berechnung wird sie noch verwendet, da
unrealistische Konzentrationsmuster bei Berechnungen auftraten.
Die Poisson Gleichung am Ende einer prognostischen Strömungsmodellierung wird nun 10x statt nur 2x durchlaufen. Bei diagnostischer
Berechnung wird sie 5x durchlaufen.
Die GRAMM Windfelder werden nun horizontal linear auf das GRAL Gitter interpoliert.
Die minimale Geländehöhe wurde bei Verwendung von originalen Topographiedaten falsch auf Basis des GRAMM Gitters berechnet.
Dies führte manchmal zur Berechnung falscher Gebäudehöhen.

August 2015:
Einlesen der wnd-Files auf automatische Kennung ob Stream oder Nicht-Stream Format umgestellt.

November 2015:
Kompiliert mit INTEL Version 16xx. Keine Änderungen im Code.

November - April 2016:
Übersetzung des Codes von Fortran nach C# (.NET 4.5.1).
Turbulenzmodell des mikroskaligen Modells von k-eps auf standardmäßig auf algebraisches Mischungswegmodell umgestellt.

**************************************************************************************************
*
*                                      OFFICIAL RELEASE 16.3
*
**************************************************************************************************

17. August 2016:
Die Rauigkeit fuer die Berechnung des Terms Program.Ustern_terrain_helpterm wird mit maximal 10% der Zellhöhe
des Strömungsgitters begrenzt. Ansonsten kommt es zu unrealistischen Strömungsprofilen.

1. September 2016:
Bei Normalanströmung einer senkrechten Gebäudewand wird die vertikale Diffusion um ca. den Druckverlust durch die Umlenkung
der Strömung erhöht. Dadurch sollen sich die teils erhöhten Konzentrationen an Fassadenwänden erniedrigen.

2. September 2016
Bei negativen Breitengraden wurde die Mischungsschichthöhe bei stabilen Schichtungen falsch berechnet.

**************************************************************************************************
*
*                                      OFFICIAL RELEASE 16.8
*
**************************************************************************************************

September 2016:
Bei Geruchsberechnungen werden zusätzlich *.odr Files erzeugt, die für das Konzentrations-Varianz-Modell der GUI
benötigt werden.
Die *.gff Files werden nun komprimiert ausgeschrieben.

November 2016 (Kuntner):
Ausschreiben der Ergebnisfiles alternativ komprimiert oder unkomprimiert
Teilchenaufteilung so programmiert, dass Aufteilung auf Sourcegroups und innerhalb der SG auf die Quellen möglich wäre
Anfangko geändert, sodass Teilchenzuordnung zu den Quellen direkt und nicht mehr zufällig erfolgt
Variablen umbenannt (alle Quellparameter beginnen z.B. mit PS/LS/TS/AS)
Programm.kenn zweigt jetzt direkt auf die jeweiligen Quelldaten, dafür zusätzliches Byte-Array Program.Sourcetype (0=PS, 1 = TS, 2 = LS, 3 =AS)
Mikrooptimierungen in Zeitschleife durch Änderungen von kenn und Sourcetype, Ausdruck 2 * Math.Pi durch Konstante Pi2 ersetzt

16.11.2016 (Öttl)
Deposition in zeitschleife.cs eingebaut.

21.11.2016 (Kuntner)
In Zeitschleife Zugriffe auf globale Arrays mit lock(Feld) versehen
In Zeitschleife globale Variable xturb und yturb durch lokale Variable ersetzt
In Zeitschleife Zugriff auf Program.Ob[][] durch lokale Variable ersetzt
In Zeitschleife Math.MIN() und Math.MAX() durch if() oder eigene Funktion Program.fl_max ersetzt (Performance)

Beim Laden von Quellen: ausgeben der Quellstärken pro Source-group
Beim Laden von GRAL.geb ausgeben der verwendeten Source-groups
Am Ende der Rechnung kommt keine Fehlermeldung mehr -> Änderungen in Program.cs und inputpgt.cs

26.1.2017 (Öttl)
Depositionsberechnung nur dort durchführen, wo Partikel auf eine horizontale Fläche treffen (zeitschleife.cs).

**************************************************************************************************
*
*                                      OFFICIAL RELEASE 17.1
*
**************************************************************************************************

10.7.2017 (Kuntner)
Absolute Gebäudehöhen eingeführt; Beim Einlesen werden absolute in relative Höhen gewandelt; Fehlermeldung, bei absoluten Höhen ohne GRAL-Gelände!

3.8.2017 (Öttl)
Durch die Verschiebung der Routine inputpgt.cs vor dem Einlesen der GRAMM Windfelder (21.11.2016) wurde mit falschen Windwerten bei der Berechnung von Ustern
gerechnet (beim ersten Durchlauf 0-Werte, danach immer jene Werte der vorherigen Wetterlage). Dieser Fehler wurde behoben.
Wenn scl-Files von GRAMM vorhanden sind, wird die Stabilitätsklasse von GRAMM für die Berechnung von u* in inputpgt.cs verwendet,
ansonsten wird die globale Stabilitätsklasse von meteopgt.all verwendet.

**************************************************************************************************
*
*                                      OFFICIAL RELEASE 17.8
*
**************************************************************************************************


1.9.2017 (Kuntner)
Warnung, wenn Quellen keine Partikel zugewiesen bekommen. User kann die Rechnung abbrechen oder fortsetzen.

11.9.2017 (Kuntner)
Wenn GRAMM Windfeld vorhanden und lokale SCL Files geladen sind, wird in GRAL_Meteozeitreihe jetzt die lokale SCL jedes Immissionspunkts ausgeschrieben. Dies kann in der GUI ausgewertet werden. Zur Unterscheidung beinhaltet das neue GRAL_Meteozeitreihe - File einen kleinen Header.

20.9.2017 (Kuntner)
Bei defektem gff-File Meldung ausgeben, Windfield neu berechnen und beim Schreiben alte (korrupte) gff-Files löschen

26.9.2017 (Öttl)
Die beiden Felder für TKE und DISS werden standardmäßig nicht mehr angelegt, um Speicherplatz zu sparen.

**************************************************************************************************
*
*                                      OFFICIAL RELEASE 17.9
*
**************************************************************************************************

5.10.2017 (Kuntner)
alle Powx() Func´s durch Public static double Funktionen in Program mit dem Zusatz [AggressiveInline] versehen; umkopieren in lokale Variable, um "starg" Optocode zu vermeiden
Beschleunigung ca. 5 bis 20 % 

Bei Null-Partikeln jetzt verständlichere Frage und Abbrechen nur mit ESC und Weiterrechnen nur mit "c". Alle anderen Tasten ohne Funktion

Linienquellen werden beim Laden aussortiert, wenn die Länge <0.001 m beträgt. Damit werden kurze Linienstücke eliminiert, die ohnehin nicht beitragen und auch meist 0 Partikel erhalten und damit zu Fehlermeldungen führen. 
Die ersten 9 Quellteile mit 0 Emission werden mit Nummer + Hinweis auf das jeweilige .dat File in der Fehlermeldung angeführt, so kann der User besser nachvollziehen, wo diese Fehler herkommen.
Alle wesentlichen Ausgaben (Quell- und SG-Anzahl, aber auch Fehlermeldungen) werden in das Lofgile_GRALCore.txt geschrieben. Dieses File wird fortgeschrieben.

8.10.2017 (Kuntner)
lokale Variable nur 1 x pro parallelem Durchlauf anlegen
Diverse Mikro-Optimierungen (help -Variable zur Minimierung von Divisionen, lokale Variable für Array-Zugriffe u.ä.)
Flowfield - Beschleunigung gegenüber 2017/08 im Mittel 10 % (bis zu 20 %)

9.10.2017 (Öttl)
Die Modellobergrenze wurde für alle Fälle (flach, Gelände, mit und ohne Gebäude) auf 800m über der niedrigsten Modellhöhe bzw. auf mind.
300m über der höchsten Erhebung gesetzt.

31.12.2017 (Öttl)
Der Zeitschritt für Tunnelportale wurde mit 0.01s nach unten begrenzt (vorher: keine Begrenzung)

2.1.2018 (Öttl)
Bei der Reflexion von Partikel wurde eine Höchstanzahl an Reflexionen eingeführt, über der ein Partikel entfernt wird, um zu verhindern,
dass eine Rechnung stecken bleibt.

15.1.2018 (Öttl)
Eine Inkonsistenz in der Berechnung der Umgebungs-Dissipation zur Ermittlung der Fahnenüberhöhung bei Punktquellen
mit Auftrieb wurde behoben. Unterschiede ergaben sich zw. Fällen mit und ohne prognostischem Windfeld, v.a. bei labilen Fällen.

**************************************************************************************************
*
*                                      OFFICIAL RELEASE 18.1
*
**************************************************************************************************

15.1.2018 (Kuntner)
Pfad für Pollutant.txt für UNIX-Systeme so umgestellt, dass diese unabhängig vom backslash sind

17.1.2018 (Öttl)
Transiente Berechnung mit Memory-Effekt implementiert.
Schreib- und Leseklassen für Program.cs ausgelagert.

20.1.2018 (Kuntner)
Mittelwert für Deposition berechnen (für transiente Berechnung)
Bei Transient Emissionsstärke merken und am Ende ausgeben
Beenden der Main-Loop im Transient Modus, wenn timeseries am Ende ist
Logfile ausgeben in Schreibklasse verlegt
Bei Transient: Rezeptorfile Receptor_Timeseries_Transient.txt ausgeben

24.1.2018 (Öttl)
Umstellung des Quellgruppen-Managements, damit Arrays bei Verwendung von beispielsweise nur einer Quellgruppe höher eins
nicht unnötig groß angelegt werden müssen.

8.2.2018 (Öttl)
Vegetation eingebaut. 

18.2.2018 (Kuntner)
Vorbereitungen für die nasse Deposition eingebaut und Depositions-Array von Float auf double umgestellt (geringe Einträge durch nasse depo pro Zeitschritt könnten bei Float beim Aufsummieren zu Rundungsfehlern führen)
Neues File Pollutant.txt im Computation Ordner zur Übergabe des Schadstoffnamens und der nassen Depositionsparameter an GRAL

23.2.2018 (Kuntner)
Zusatzausgaben, wenn GRAL mit den Parametern LOGLEVEL01 (Ausgabe der klassierten Anzahl der Reflexionen und Zeitsteps) oder LOGLEVEL02 (zusätzlich Ausgabe der Partikelanzahl pro Quelle) gestartet wird

28.2.2018 (Kuntner)
Die Zeitschleife auf While() umgestellt, sodass bei Rücksprüngen zu Move_Forward: weitergezählt und bei Überschreitung abgebrochen wird

1.3.2018 (Öttl/Kuntner)
Der Zeitschritt im Tunnelportal wurde mit 0.05s nach unten begrenzt. Die max.Anzahl der Time_Steps wird in Abhängigkeit der Rechengebietsgröße festgelegt

9.3 - 14.3.2018 (Kuntner)
Beim Einlesen von gff Files ganze Blöcke einer vertikalen Zeile einlesen -> Beschleunigung Faktor 10
Das Einlesen der Rezeptoren vom Zurücksetzen der KOnzentration getrennt. Das Einlesen sicherer ausprogrammiert, sodass fehlerhafte Zeilen nicht zu einem Abbruch führen. Ausgabe der Rezeptor-Indizes im Gitter.
Die Threshold für den Transientmodus auf zumindest Float.Epsilon setzen
Die Vertikale Konzentration nur auswerten und ausgeben, wenn ein File "GRAL_Vert_Conc.txt" vorhanden ist
Das GFF-File wird in einem eigenen Thread ausgeschrieben. Damit kann die Ausbreitungsrechnung schon starten, auch wenn das Schreiben des GFF Files noch andauert

17.3 - 21.3.2018 (Kuntner)
Quellen oder Quellteilen werden eine Mindestzahl von Partikeln zugeordnet (zumindest 3 bei Linien-, 1 bei Flächenquellen, 5 bei Portalen und Punktquellen; bei kleinen Quellen-Anzahlen höhere Mindestpartikel-Anzahl)
Die Partikelmasse wird in Abhängigkeit der Quellstärke und der Partikelanzahl berechnet
Die Filestreams beim Lesen der meteopgt.all und mettimeseries.dat werden mit Using versehen, damit die Files wieder frei gegeben werden
Als Version 18.04Alpha versioniert
xcoord[] und ycoord[]in float statt double angelegt
Write_Gral_Flowfield: zuerst Höhenzeile in Buffer schreiben, dann ausschreiben. Statt ZipArchiveMode.Update jetzt ZipArchiveMode.Create
Damit können auch große GFF-Files ausgeschrieben werden (kein Speicherüberlauf) und das Ausschreiben ist beschleunigt

3.4.2018 (Kuntner)
Abfrage für Randbedingung am westlichen Einströmrand in prognostic.cs war falsch.

9.4. - 30.4.2018 (Kuntner)
U,V und W Routine für prognostische Windfelder vektorisiert und optimiert. Als 18.04 versioniert

25.4.2018 (Öttl)
Übernahme von GRAMM Windfeldern nun auch vertikal interpoliert, um Stufenform in größeren Höhen zu vermeiden.

27.4.2018 (Öttl)
Decay Rate wurde eingebaut.

25.7.2018 (Kuntner)
Neuer optionaler Startparameter mit dem Pfad des Computation Ordners, damit GRAL aus einem beliebigen Ordner gestartet werden kann und nicht ins Projekt kopiert werden muss.

12.9.2018 (Öttl)
Ausgabe von buildings_heights.txt war bei Gelände mit Originaltopographie fehlerhaft.

17.9.2018 (Kuntner)
Zusätzliche Ausgaben in das Logfile_GRALCore.txt bezüglich des berechneten Schadstoffs, der nassen Deposition und der Decay Rate.

5.10.2018 (Kuntner)
in Zeitschleife und Zeitschleife_Nonsteadystate alle Convert.ToInt16 in Convert.ToInt32 geändert und Prüfung, ob der Wert < Int32.MaxValue

10.11.2018 (Kuntner)
In Rezeptor_Timeseries.txt den Header für Geruchsberechnungen angepasst
Die 3D temporären Konzentrationsfelder alle 24 Stunden (statt 20 h) ausschreiben

22.11.2018 (Kuntner)
Wenn in input_mettimeseries.cs bei search_weather_situation() kein exakter Match gefunden wird, bestmöglichen Match zwischen mettimeseries und meteopgt suchen

22.11.2018 (Öttl)
Division durch Null bei null-Geschwindigkeit in progrnostic_flowfield.cs beseitigt.

**************************************************************************************************
*
*                                      OFFICIAL RELEASE 19.1
*
**************************************************************************************************

Februar 2019 (Kuntner)
Einlesen der zeitabhängigen Quellparameter aus Zeitreihen und Einbinden der Parameter in die Berechnung
Neues File: "KeepAndReadTransientTempFiles.dat" : wenn dieses File vorhanden ist, werden die temporären Files für die trasiente Berechnung nicht gelöscht, beim Neustart wird mit der 
aktuellen Wettersituation (und nicht mit der gespeicherten) weitergerechnet und es wird ein Wert eingelesen, der bestimmt, wie oft temporäre Files geschrieben werden

März 2019 (Kuntner)
Jetzt kann der Pfad zum Schreiben und Lesen der GFF Files (in einem eigenen File übergeben) vorgegeben werden.
Interne Quellen - und Partikelkoordinaten auf double zurückgestellt, damit einheitlich zur aktuellen GUI 20.01 für Koordinatensysteme auch große Zahlen verarbeitet werden können Rundung von float ~ 6 - 9 digits)

6.4.2019 (Kuntner)
In allem Schleifen zur Indexsuche kkkk  durch die jeweiligen Zielvariable ersetzt
In Intstand (float)Math.Sqrt(Program.Pow2(sigmauhurly)) durch Math.Abs(sigmauhurly) ersetzt
In den Auswerteschleifen <=Program.NS durch < kko.lenght ersetzt
RecentCellBuildingHeight eingeführt, um mehrfache Abfrage dieses Arrays zu vermeiden
Convert.ToInt32() durch eigene Funktion ersetzt

13.4.2019 (Kuntner)
Weitere Mikro-Optimierungen in Zeitschleife() und Zeitschleife_Nonsteadystate()
Konditionelle Kompilierung eingesetzt, um die neuen .NetCore MathF Befehle verwenden zu können -> erheblicher Performance Sprung!
IUstern und JUstern auch gegen 0 prüfen, da fallweise Absturz möglich ist
Maximale Anzahl der Reflexionen in Abhängigkeit der Zellenanzahl setzen

26.4.2019 (Kuntner)
ADVDOM auf Byte[][] umgestellt (hat nur Werte 1 und 0)
Zusätzliche Abfrage bei absoluter Gebäudehöhe, wenn Gebäudehöhe unter Gelände ist -> Gebäudehöhe 0 setzen in ReadBuildingsTerrain()
AKL_GRAMM von double[,] auf int[,] umgestellt, weil AK nur Integer-Werte haben kann

29.4.2019 (Kuntner)
Die Routine zum Speichern von *.gff Files wurde umgestellt, sodass der Komprimierungsalgorithmus besser arbeiten kann (kleinere Files)

10.5.2019 (Kuntner)
Das vertikale Flow Field Gitter kann in Abschnitten mit unterschiedlichen Stretching-Faktoren erstellt werden
Zusätzliche Abfragen für die Indizes in Zeitschleife und Zeitschleife_Nonsteadystate und bestehende Abfragen adaptiert
Beim Lesen von *.gff Files die Geometrie nur 1x lesen; dazu neues globales Flag - GeometryAlreadyRead
SimpleRNG() ist nicht Thread-Safe! und darf daher in parallelen Schleifen nicht verwendet werden (keine ausreichenden Zufallszahlen); 
Daher neue Initialisierung der Zufallszahlen mittels Random()

16.5.2019 (Kuntner)
Die Größe der Sub Domains können mit einem neuen Parameter in in.dat nach der Angabe, ob prognostisch gerechnet werden soll, vorgegeben werden; Minimum 15!

25.5.2019 (Kuntner)
Alle folgenden Änderungen mit "19.05.25 Ku" markiert!
 - In den ersten 20 s wird bei einem Geländesprung die Partikelhöhe in den untersten Zellen mit einer exp. Anpassungsfunktion korrigiert 
 - Ein neuer BinarySearch Algorithmus wird verwendet, um den Index in HOKART[] zu finden -> max. O(log(n)) Iterationen -> Performance Steigerung
Erhöhung der Performance beim Schreiben und Lesen von stark komprimierten GFF Files
Zusätzlicher Seed Wert beim Zufallsgenerator in Anfangko()

3.6.2019 (Kuntner)
Beim Lesen und Schreiben des neuen *.GFF Formats Bitshift statt Bitconverter -> Performance + Convert.ToInt16 eingebaut -> Rundung

10.6.2019 (Kuntner)
Optionales, besser komprimiertes (schnelleres) und gegen Schreibfehler besser abgesichtertes *.grz File-Format - Format 2
19.6.2019 (Kuntner)
Noch ein zweites neues *.grz File mit allen Rasterzellen - Format 3

20.6.2019 (Kuntner)
Decay rates können für jede Quellgruppe seperat übergeben werden

24.6.2019 (Kuntner)
Vector von Konstanten static readonly gesetzt -> 5-10% Performance gain für die Flow-Field Berechnung

8.7.2019 (Kuntner)
Key Taste beim Beenden von GRAL jetzt optional

14.7.2019 (Kuntner)
ASCii Ausgabe der Ergebnisse, wenn in in.dat ascii definiert wird (alternativ zu Format 2 und 3, das am 19. und 19.6. eingeführt wurde)
**************************************************************************************************
*
*                                      RELEASE 20.1Beta3
*
**************************************************************************************************
1.10.2019 (Öttl/Kuntner)
Korrektur der ausgegebenen Windrichtung, damit die Ausgabe auf +- 360° begrenzt ist
Lesezugriffe der *.gff Files und des Files "GRAL_geometries.txt" auf FileShare.Read gesetzt, damit mehrere Instanzen gleichzeitig lesen können
Als 20.01Beta4 versioniert 

4.10.2019 (Kuntner)
Fehlermeldung und Überspringen der Situation im transienten Modus, wenn keine passende Wettersituation in meteopgt.all gefunden werden kann
Bereinigungen im *.gff File Reader 
Rücksprung bei fehlendem Windfeld in if-Abfrage integriert -> goto ist eliminiert
Auch die Lesezugriffe auf GRAMM *.wnd und *.scl Files auf FileShare.Read gesetzt
Rundung bei der Berechnung der Windrichtung für die Konsolen-Ausgabe
Refactoring light: 
  * Aufteilung der Program.cs in 3 Files
  * Bereinigung der konditionellen Kompilierung (.NetFramework wird nicht mehr unterstützt)
  * Variablennamen z.T. bereinigt
  * BinarySearch auch für HOKART_Trans[]
  * Teilweise die neue Option MethodImplOptions.AggressiveOptimization gesetzt
  * Math.Clamp() verwendet
  * Unnötige casts (float) entfernt
  * .NetFramework compiler direktiven entfernt
  * Ausgabe für GUI nur alle 20% dafür kontinuierlich von 0-100% im transienten Modus
  * Meandering: bool statt string Variable: bool MeanderingOff 
  * Span und stackalloc für kleine Arrays in parallelen Schleifen
  * In Intwind() und MicroscaleFlat() wird anstelle der globalen Variablen Program.IUstern und Program.JUstern (diese waren immer 1) die Zahl 1 eingetragen

18.10.2019 (Kuntner)
GetHashCode() eingeführt

3.11.2019 (Kuntner)
In der transienten Rezeptorausgabe werden bei den Rezeptoren auch deren Koordinaten ausgegeben
In Intwind() wird die Routine BinarySearch() durch lokale Referenzen etwas beschleunigt (nach einer IL Code Analyse)

9.11.2019 (Kuntner)
Rezeptoren werden jetzt an der echten Rezeptorposition xrez +- dx/2 und yrez +- dy/2 ausgewertet. Beim Laden der Rezeptoren wird geprüft, ob innerhalb des Rezeptor-Gitters ein Gebäude liegt, wenn FlowField und Konzentrationsraster gleich sind.
Falls dort ein Gebäude liegt, wird die Konzentration in der Rasterzelle vor dem Gebäude gebildet (wenn FlowField Raster == Konzentrationsraster).
Sehr einfacher Versuch, eine statistische Angabe über die Ergebnisqualität an Rezeptoren anzugeben; dazu wird der maximale Beitrag eines Partikels und die Konzentrationssumme an den Rezeptoren gespeichert

25.11.2019 (Kuntner)
Konzentrationskorrektur, wenn das Konzentrationsvolumen durch Gebäude eingeschränkt wird, für jene Fälle, in denen das Konzentrationsgitter größer als das FlowField Gitter ist
dies wurde als Post-Processing vor dem Ausschreiben der Konzentrationsarrays und der Rezeptorkonzentrationen integriert
Rezeptornamen, wenn vorhanden, speichern und in der Konsole und im transienten Timeserie-File ausgeben
Als RC1 versioniert

5.12.2019 (Kuntner)
Auf Open Source vorbereitet; 
Ausgabe der Rezeptorpunkte um Meteodaten am Rezeptorpunkt erweitert im transienten GRAL Modus; Ausgabe des Rezeptorfiles mit Unicode Encoding
Als 20.01 (final) versioniert

17.1.2020 (Öttl)
Bessere Zuordnung der Wettersituationen von mettimeseries zu meteopgt.all

27.1.2020 (Kuntner)
Besserer Support für steile Linienquellen, indem die Länge aus dx, dy und dz berechnet wird

3.3.2020 (Kuntner)
BugFix für die geänderten File-Formate für die GRAL GRAL_Meteozeitreihe

13.3.2020 (Kuntner)
Neues Ausgabeformat für die GRAL Konzentrations-Zeitreihe
Splitten der großen Klassen zum Lesen der Eingangsdaten

19.3.2020 (Kuntner)
Schreibe in den Zip-Container keine Pfadangaben

30.20.2020 (Kuntner)
Die ModelTopHeight wurde immer aus Zelle 1,1 genommen, aber wenn dort keine Sub Domain ist und hohes Gelände, ist die Windgeschw. 0 -> Division durch 0

31.3.2020 (Kuntner)
Verwende auch den Index 0 für die Konzentrationen -> spare 1 mal SG-Anzahl Indizes

1.4.2020 (Kuntner)
Verwende auch den Index 0 für die Quellgruppen -> spare Konzentrationen mal 1 Indizes
Zeige bereits berechnete Emissionssummen an, wenn eine abgebrochene transiente Berechnung neu gestartet wird

25.4.2020 (Kuntner)
Bereinige Inidizes für Flow-Field und GRAMM Zellen in den Zeitschleifen 
Lege die Gebäudereflexion für ebenes und komplexes Gelände zusammen
Verwende Tuples für Intwind() und Intstand()
Bereinige Indizes in Intstand()
Verwerfe Partikel im transienten Modus nicht, wenn diese die BLH überschreiten würden
Das GRAMM Grid ist immer größer als das GRAL Grid. Wenn in einem ungünstigen Fall durch Rundungsfehler ein Index im Gramm Grid außerhalb des Netzes auftritt, wird 
aktuell das Partikel entfernt. Neu wird die nächste GRAMM Zelle im Grid weiter verwendet, entfernt wird das Partikel, wenn es das FlowField Grid verlässt.

28.4.2020 (Kuntner)
Teile die Leseroutine Input_pgt auf, verwende MathF, verringere Array-Zugriffe und verwende Tuples 

29.4.2020 (Kuntner)
Behebe Fehler bei der Berechnung des GRAMM Indes in der Flow Field Berechnung -> bisher wurde immer die Rauigkeit am Index [1][1] verwendet, auch wenn Gelände mit variabler Rauigkeit vorhanden war!
Estelle Routine InitAdaptiveRoughness.cs zur Initialisierung der GRAL Rauigkeitslängen
Integriere meine Filterroutine (adaptiver 2 dimensionaler Low-Pass Filter)
Baue GRAL Rauigkeitslänge in Flow Field Berechnung, Zeitschleifen und input_pgt.cs ein

5.5.2020 (Kuntner)
Addiere blockierte Zellen bei Gebäuden mit Gelände nur, wenn diese höher sind als das Gelände 

8.5.2020 (Kuntner)
Initialisiere Plume Rise mit standwind statt mit windge, um die Überhöhung nicht zu stark zu vermindern und begrenze standwind-Faktor auf 0.5-1.5 am Beginn und 0-5 in TimeLoop

10.5.2020 (Kuntner)
Korrigiere Windrichtung für inputzr.dat für Vielfache von 2Pi

17.5.2020 (Kuntner)
Berichtige Rauigkeit von Gebäuden in der Flow-Field Berechnung, wobei nur Gebäude > 1 m Höhe als Gebäude herangezogen werden. Darunter wird die Rauigkeit des Geländes verwendet.

1.6.2020 (Kuntner)
Teile transiente Partikel mit hoher Zellkonzentration in Sub-Partikel, um Partikel mit hoher Masse zu vermeiden

3.6.2020 (Kuntner)
Ergänze Berechnung und Ausgabe der mittleren Austrittstemp.und Austrittsgeschwindigkeit bei Zeitreihenrechnungen

6.6.2020 (Kuntner)
Neues *.gff File Format
Zusätzliche Ausgaben für Zeitreihen Austrittsgeschw./Austrittstemp. bei transienter Berechnung

8.6.2020 (Kuntner)
Fange GRAMM Gebiete < GRAL Gebiet ab, aber ermögliche trotzdem Berechnung ohne Absturz
Zeige die Fortdauer des *.gff File Schreibens an, wenn das Schreiben länger dauert, als die Ausbreitungsrechnung

15.6.2020 (Kuntner)
Erlaube alternativ, Gebäudehöhen über ein ESRI-ASCII File einzulesen. Name: BuildingsRaster.dat

16.6.2020 (Kuntner)
Erlaube neben "\t" auch "," als Trennzeichen für Austrittstemp. und Austrittsgeschw. Files
